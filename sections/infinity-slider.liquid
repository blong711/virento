{% schema %}
{
  "name": "t:sections.infinity-slider.name",
  "tag": "section",
  "class": "flat-spacing pt-0 pb-0",
  "settings": [
    {
      "type": "range",
      "id": "animation_speed",
      "min": 20,
      "max": 200,
      "step": 5,
      "default": 80,
      "label": "t:sections.infinity-slider.settings.animation_speed"
    },
    {
      "type": "range",
      "id": "clone_count",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 2,
      "label": "t:sections.infinity-slider.settings.clone_count"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "t:sections.infinity-slider.settings.icon_color",
      "default": "#7B53FF"
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "t:sections.infinity-slider.blocks.text_item.name",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "t:sections.infinity-slider.blocks.text_item.settings.text",
          "default": "Free Shipping"
        },
        {
          "type": "select",
          "id": "text_class",
          "label": "t:sections.infinity-slider.blocks.text_item.settings.text_class",
          "options": [
            {
              "value": "text-grey-7",
              "label": "t:sections.infinity-slider.blocks.text_item.settings.text_class.options.grey"
            },
            {
              "value": "text-clip-2",
              "label": "t:sections.infinity-slider.blocks.text_item.settings.text_class.options.gradient"
            }
          ],
          "default": "text-grey-7"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Infinity Slider",
      "category": "Text",
      "blocks": [
        {
          "type": "text",
          "settings": {
            "text": "Free Shipping",
            "text_class": "text-grey-7"
          }
        },
        {
          "type": "text",
          "settings": {
            "text": "Shop Now, Pay Later",
            "text_class": "text-clip-2"
          }
        },
        {
          "type": "text",
          "settings": {
            "text": "Free Returns",
            "text_class": "text-grey-7"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<script>
  class InfinitySliderSection extends HTMLElement {
    constructor() {
      super();
      this.infinitySlider = null;
      this.initializeSlider();
      
      // For Shopify theme editor
      document.addEventListener('shopify:section:load', (event) => {
        if (event.detail.sectionId === this.dataset.sectionId) {
          this.initializeSlider();
        }
      });
      
      document.addEventListener('shopify:section:unload', (event) => {
        if (event.detail.sectionId === this.dataset.sectionId && this.infinitySlider) {
          this.infinitySlider.destroy();
          this.infinitySlider = null;
        }
      });
      
      document.addEventListener('shopify:section:select', (event) => {
        if (event.detail.sectionId === this.dataset.sectionId && this.infinitySlider) {
          this.infinitySlider.resume();
        }
      });
      
      document.addEventListener('shopify:section:deselect', (event) => {
        if (event.detail.sectionId === this.dataset.sectionId && this.infinitySlider) {
          this.infinitySlider.resume();
        }
      });
    }
    
    initializeSlider() {
      // Wait for the DOM to be ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => this.setupSlider());
      } else {
        this.setupSlider();
      }
    }
    
    setupSlider() {
      // Destroy previous instance if it exists
      if (this.infinitySlider) {
        this.infinitySlider.destroy();
        this.infinitySlider = null;
      }
      
      // Find the slider element
      const sliderElement = this.querySelector('.infiniteslide');
      if (!sliderElement) return;
      
      // Get options from data attribute
      const options = JSON.parse(sliderElement.dataset.infiniteslide || '{}');
      
      // Create new instance
      if (typeof InfiniteSlide !== 'undefined') {
        this.infinitySlider = new InfiniteSlide(sliderElement, options);
      } else {
        console.error('InfiniteSlide library not loaded');
      }
    }
  }
  
  // Register the custom element
  customElements.define('infinity-slider-section', InfinitySliderSection);
</script>

<infinity-slider-section class="section" data-section-id="{{ section.id }}" data-section-type="infinity-slider">
  <div class="">
  <div class="infiniteslide_wrap">
    <div class="infiniteslide tf-brand style-2" 
         data-infiniteslide='{"speed": {{ section.settings.animation_speed }}, "clone": {{ section.settings.clone_count }}, "direction": "left", "pauseonhover": true}'>
      
      {% for block in section.blocks %}
        {% if block.type == 'text' %}
          <div class="brand-item">
            <p class="display-2xl fw-semibold {{ block.settings.text_class }}">{{ block.settings.text }}</p>
          </div>
          
          {% unless forloop.last %}
            <div class="brand-item icon-item">
              <svg width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M42 18.9H26.04L37.38 7.56L34.44 4.62L23.1 15.96V0H18.9V15.96L7.56 4.62L4.62 7.56L15.96 18.9H0V23.1H15.96L4.62 34.44L7.56 37.38L18.9 26.04V42H23.1V26.04L34.44 37.38L37.38 34.44L26.04 23.1H42V18.9Z" fill="{{ section.settings.icon_color }}"></path>
              </svg>
            </div>
          {% endunless %}
        {% endif %}
      {% endfor %}      
    </div>
  </div>
</div>
</infinity-slider-section>
