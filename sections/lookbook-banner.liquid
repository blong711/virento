{% comment %}
  Lookbook Banner Section
  - Configurable banner image, title, and subtitle
  - Lookbook pins as blocks with product selection and pin position (top/left percentages)
{% endcomment %}

<section class="flat-spacing color-{{ section.settings.color_scheme }} gradient section-{{ section.id }}-padding" data-section-id="{{ section.id }}">
	<div class="{{ section.settings.width }}">
		{% if section.settings.heading != blank or section.settings.subheading != blank %}
		<div class="flat-title wow fadeInUp{% if section.settings.title_alignment == 'center' %} text-center{% endif %}">
			{% if section.settings.heading != blank %}
			<{{ section.settings.title_tag }} class="title">{{ section.settings.heading }}</{{ section.settings.title_tag }}>
			{% endif %}
			{% if section.settings.subheading != blank %}
			<p class="desc {{ section.settings.subtitle_size }}" style="color: rgb(var(--color-foreground2));">{{ section.settings.subheading }}</p>
			{% endif %}
		</div>
		{% endif %}

		<div class="banner-lookbook">
			{% if section.settings.banner_image != blank %}
			<img
				class="img-banner"
				srcset="
					{{ section.settings.banner_image | image_url: width: 640 }} 640w,
					{{ section.settings.banner_image | image_url: width: 960 }} 960w,
					{{ section.settings.banner_image | image_url: width: 1440 }} 1440w,
					{{ section.settings.banner_image | image_url: width: 1920 }} 1920w
				"
				sizes="(max-width: 768px) 100vw, 1200px"
				src="{{ section.settings.banner_image | image_url: width: 1440 }}"
				alt="{{ section.settings.banner_image.alt | default: section.settings.heading | escape }}"
				loading="lazy"
				width="1440"
				height="1440"
			>
			{% endif %}

			{% for block in section.blocks %}
			{% assign pinned_product = block.settings.product %}
			<div class="lookbook-item" style="position: absolute; top: {{ block.settings.top_pct }}%; left: {{ block.settings.left_pct }}%; transform: translate(-50%, -50%);" {{ block.shopify_attributes }}>
				<div class="dropdown dropup-center dropdown-custom">
					<div role="dialog" class="tf-pin-btn" data-bs-toggle="dropdown" aria-expanded="false">
						<span></span>
					</div>
					<div class="dropdown-menu">
						<div class="loobook-product style-row">
							<div class="img-style">
								{% if pinned_product and pinned_product.featured_image %}
								<img
									src="{{ pinned_product.featured_image | image_url: width: 320 }}"
									alt="{{ pinned_product.title | escape }}"
									loading="lazy"
									width="320"
									height="320"
								>
								{% else %}
								<div style="width: 96px; height: 96px; background: #f5f5f5;"></div>
								{% endif %}
							</div>
							<div class="content">
								<div class="info">
									{% if pinned_product %}
									<a href="{{ pinned_product.url }}" class="text-md fw-medium text-line-clamp-1 link">{{ pinned_product.title }}</a>
									<p class="price-wrap text-md fw-medium">
										<span class="price-new text-primary">{{ pinned_product.price | money }}</span>
										{% if pinned_product.compare_at_price > pinned_product.price %}
										<span class="price-old">{{ pinned_product.compare_at_price | money }}</span>
										{% endif %}
									</p>
									{% endif %}
								</div>
								{% if pinned_product %}
								<div 
									class="hover-tooltip box-icon quickview btn-quickview btn-lookbook" 
									data-product-id="{{ pinned_product.id }}"
									data-product-handle="{{ pinned_product.handle }}"
									data-product-title="{{ pinned_product.title | escape }}"
									data-product-price="{{ pinned_product.price | money }}"
									data-product-compare-price="{{ pinned_product.compare_at_price | money }}"
									data-product-description="{{ pinned_product.description | strip_html | truncate: 150 | escape }}"
									data-product-url="{{ pinned_product.url }}"
									data-product-images="{% for image in pinned_product.images %}{{ image | image_url: width: 600 }}{% unless forloop.last %},{% endunless %}{% endfor %}"
									data-product-variants="{{ pinned_product.variants | json | escape }}"
									data-product-options="{{ pinned_product.options_with_values | json | escape }}"
									aria-label="Quick view of {{ pinned_product.title }}">
									<i class="icon icon-view" aria-hidden="true"></i>
									<span class="tooltip">{{ 'snippets.product-card.quick_view' | t }}</span>
								</div>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
</section>

{% style %}
	.section-{{ section.id }}-padding {
			padding-top: calc({{ section.settings.padding_top }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
			padding-bottom: calc({{ section.settings.padding_bottom }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
		}

	@media screen and (min-width: 750px) {
		.section-{{ section.id }}-padding {
		padding-top: {{ section.settings.padding_top }}px;
		padding-bottom: {{ section.settings.padding_bottom }}px;
		}
	}
{% endstyle %}

{% schema %}
{
	"name": "Lookbook banner",
	"tag": "section",
	"class": "section-lookbook-banner",
	"settings": [
		{
			"type": "color_scheme",
			"id": "color_scheme",
			"label": "Colors",
			"default": "scheme-1"
		},
		{
			"type": "select",
			"id": "width",
			"label": "Section width",
			"options": [
				{ "value": "container", "label": "Boxed" },
				{ "value": "container-full", "label": "Full width" }
			],
			"default": "container"
		},
		{
			"type": "text",
			"id": "heading",
			"label": "Heading",
			"default": "Inspired by You"
		},
		{
			"type": "select",
			"id": "title_alignment",
			"label": "Title alignment",
			"options": [
				{ "value": "start", "label": "Default" },
				{ "value": "center", "label": "Center" }
			]
		},
		{
			"type": "select",
			"id": "title_tag",
			"label": "Title size",
			"options": [
				{ "value": "h5", "label": "Small" },
				{ "value": "h4", "label": "Medium" },
				{ "value": "h3", "label": "Large" }
			],
			"default": "h4"
		},
		{
			"type": "text",
			"id": "subheading",
			"label": "Subheading",
			"default": "Find everything you need to recreate the look."
		},
		{
			"type": "select",
			"id": "subtitle_size",
			"label": "Subtitle size",
			"options": [
				{ "value": "text-sm", "label": "Small" },
				{ "value": "text-md", "label": "Medium" },
				{ "value": "text-lg", "label": "Large" }
			],
			"default": "text-md"
		},
		{
			"type": "image_picker",
			"id": "banner_image",
			"label": "Banner image"
		},
		{
			"type": "header",
			"content": "Section padding"
		},
		{
			"type": "range",
			"id": "padding_top",
			"min": 0,
			"max": 120,
			"step": 4,
			"unit": "px",
			"label": "Padding top",
			"default": 0
		},
		{
			"type": "range",
			"id": "padding_bottom",
			"min": 0,
			"max": 120,
			"step": 4,
			"unit": "px",
			"label": "Padding bottom",
			"default": 0
		},
		{
			"type": "range",
			"id": "padding_mobile_rate",
			"min": 0,
			"max": 100,
			"step": 5,
			"unit": "%",
			"label": "Mobile padding scale",
			"default": 75
		}
	],
	"blocks": [
		{
			"type": "pin",
			"name": "Lookbook pin",
			"limit": 8,
			"settings": [
				{
					"type": "product",
					"id": "product",
					"label": "Product"
				},
				{
					"type": "range",
					"id": "top_pct",
					"label": "Top position (%)",
					"min": 0,
					"max": 100,
					"step": 1,
					"unit": "%",
					"default": 20
				},
				{
					"type": "range",
					"id": "left_pct",
					"label": "Left position (%)",
					"min": 0,
					"max": 100,
					"step": 1,
					"unit": "%",
					"default": 30
				}
			]
		}
	],
	"presets": [
		{
			"name": "Lookbook banner",
			"category": "Image",
			"blocks": [
				{ "type": "pin" },
				{ "type": "pin" }
			]
		}
	]
}
{% endschema %}

